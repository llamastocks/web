<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="static/style.css"> 
    <div class="logo">
        <h1>LlamaStocks</h1>
    
    </div> 
        <nav id="site-nav">
            <div id="menu-container">
                <ul id="primary-menu">
                    <li class="nav-menu" id="menu-1">
                        <a href='index.html'>
                            Inicio
                        </a>
                    </li>
                    <li class="nav-menu" id="menu-2">
                        <a class="active" href='simulator.html'>
                            Simulador
                        </a>
                    </li>
                    <li class="nav-menu" id="menu-3">
                        <a href='donations.html'>
                            Donaciones
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
</head>
<script id="ic-api" src="https://t60692c4364c5750009bef1b9.projects.ideascloud.io/api.js"></script>

<script type="text/Javascript">
    icAPI.callService('getStocks',{},function(error,response){
        if (error){
            console.log('Error:',error);
            return;
        }
        console.log(response.responseJSON)
        var stockSelectElement = document.getElementById("stock");
        var stocksList=response.responseJSON;
        stocksList.forEach(function (stock) {
            var stockOptionElement=document.createElement("option");
            stockOptionElement.value=stock.ticker+"-"+stock.moneda;
            stockOptionElement.innerHTML=stock.emisor+" - "+stock.ticker+" - "+stock.moneda;
            stockSelectElement.appendChild(stockOptionElement);
        })
    })

    function tipoMoneda() {
        var str=document.getElementById("stock").value.split("-")[1];
        console.log(str)
        if (str.includes("soles")){

            document.getElementById("tc").readOnly=true;

        }else{

            document.getElementById("tc").readOnly=false;

        }
        
    }

    function calculate() {
        var stock=document.getElementById("stock").value.split("-")[0];
        var p=document.getElementById("pcompra").value;
        var sab=document.getElementById("sab").value;
        var minSAB=document.getElementById("minsab").value;
        var capital=document.getElementById("capital").value;
        var tc=document.getElementById("tc").value;
        
        p=parseFloat(p)
        sab=parseFloat(sab)
        minSAB=parseFloat(minSAB)
        capital=parseFloat(capital)
        tc=parseFloat(tc)
        console.log(stock,p,sab,minSAB,capital)

        const fg=0.000075
        const smv=0.000135
        const igv=0.18
        
        var moneda=document.getElementById("stock").value.split("-")[1];
        if (moneda=="soles"){
            minCAV=5
        }else{
            minCAV=5/tc
        }

        var IBGC=["ALICORC1","ALICORI1","BBVAC1","CPACASC1","CPAC",
        "BUENAVC1","BVN","ENGIEC1","FERREYC1","INRETC1","IFS","RIMSEGC1"
        ]

        Array.prototype.contains=function(obj){
            var i=this.length;
            while (i--){
                if (this[i]===obj){
                    return true;
                }
            }
            return false;
        }

        if (IBGC.contains(stock)==true){
            var cavali=0.00004095;
            var bvl=0.000021
        }else{
            var cavali=0.0004095;
            var bvl=0.00021
        }

        var caso1=(capital*p*sab)/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv+(1+igv)*sab+(1+igv)*cavali))
        var caso2=(capital*p*cavali)/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv+(1+igv)*sab+(1+igv)*cavali))

        if (caso1>minSAB && caso2>minCAV){
            var acciones=capital/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv+(1+igv)*sab+(1+igv)*cavali));
            var acciones=Math.round(acciones-0.5);
            var precio_minimo=capital/(acciones*(1-1.18*sab-1.18*bvl-1.18*fg-smv-1.18*cavali));
            var precio_minimo=Math.ceil(precio_minimo*100)/100;            
        }

        var caso3=(sab*p*(capital-(1+igv)*(minSAB)))/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv+(1+igv)*cavali))
        var caso4=(cavali*p*(capital-(1+igv)*(minSAB)))/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv+(1+igv)*cavali))

        if (caso3<minSAB && caso4>minCAV){
            var acciones=(capital-(1+igv)*minSAB)/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv+(1+igv)*cavali));
            var acciones=Math.round(acciones-0.5);
            var precio_minimo=(capital+1.18*minSAB)/(acciones*(1-1.18*bvl-1.18*fg-smv-1.18*cavali));
            var precio_minimo=Math.ceil(precio_minimo*100)/100;
        }
        var caso5=(sab*p*(capital-(1+igv)*(minCAV)))/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv+(1+igv)*sab))
        var caso6=(cavali*p*(capital-(1+igv)*(minCAV)))/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv+(1+igv)*sab))

        if (caso5>minSAB && caso6<minCAV){
            var acciones=(capital-(1+igv)*(minCAV))/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv+(1+igv)*sab));
            var acciones=Math.round(acciones-0.5);
            var precio_minimo=((capital+1.18*minCAV)/(acciones*(1-1.18*sab-1.18*bvl-1.18*fg-smv)));
            var precio_minimo=Math.ceil(precio_minimo*100)/100;
        }
        var caso7=(sab*p*(capital-(1+igv)*(minSAB+minCAV)))/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv))
        var caso8=(cavali*p*(capital-(1+igv)*(minSAB+minCAV)))/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv))

        if (caso7<minSAB && caso8<minCAV){
            var acciones=(capital-(1+igv)*(minSAB+minCAV))/(p*(1+(1+igv)*bvl+(1+igv)*fg+smv));
            var acciones=Math.round(acciones-0.5);
            var precio_minimo=(capital+1.18*minSAB+1.18*minCAV)/(acciones*(1-1.18*bvl-1.18*fg-smv));
            var precio_minimo=Math.ceil(precio_minimo*100)/100;
        }     
        
        var invertido=p*acciones;

        if (invertido*sab>minSAB){
            var comision=invertido*sab;
        }else{
            var comision=minSAB;
        }

        var comision_bvl=p*acciones*bvl;
        var comision_fg=p*acciones*fg;
        var comision_smv=p*acciones*smv;

        if (invertido*cavali>minCAV){
            var comision_cavali=invertido*cavali;
        }else{
            var comision_cavali=minCAV;
        }

        var comision_igv=(comision+comision_bvl+comision_fg+comision_cavali)*igv; 
        
        var total=invertido+comision+comision_bvl+comision_fg+comision_smv+comision_cavali+comision_igv;
        var saldo=capital-total;
        console.log(acciones,stock,invertido,comision)
        document.getElementById("result").innerHTML="Puedes comprar "+acciones+" acciones de "+stock+"<br>Monto Invertido: "+invertido.toFixed(2)+"<br> Comisión SAB: "+comision.toFixed(2)+"<br> Comisión BVL: "+comision_bvl.toFixed(2)+"<br> Fondo de Garantía: "+comision_fg.toFixed(2)+"<br> Comisión SMV: "+comision_smv.toFixed(2)+"<br> Comisión CAVALI: "+comision_cavali.toFixed(2)+"<br> IGV: "+comision_igv.toFixed(2)+"<br> Monto Transado: "+total.toFixed(2)+"<br> Saldo: "+saldo.toFixed(2)+"<br> Requieres que el precio suba a "+precio_minimo+" para recuperar tu capital.";
    }
</script>

<h5>Calculadora de acciones BVL</h5>
<p>Utiliza esta calculadora para sacar cuántas acciones obtendrías con el capital que deseas</p>
<div id="calculadora-compra">
    <div id="calculadora">
    
    <form name="myform" method="POST">
        <label for="stock">Acción: </label><br>
        <!-- <select type="text" id="stock" name="stock"><br> -->
        <select id="stock" onchange="tipoMoneda()">
            <option value="">
                Elige una acción:
            </option>
        </select><br>
        <label for="pcompra">Precio de Compra: </label><br>
        <input type="number" id="pcompra" name="pcompra"><br>
        <label for="sab">Comisión SAB (%): </label><br>
        <input type="number" id="sab" name="sab"><br>
        <label for="minsab">Comisión mínima SAB: </label><br>
        <input type="number" id="minsab" name="minsab"><br> 
        <label for="capital">Monto a Invertir: </label><br>
        <input type="number" id="capital" name="capital"><br>
        <label for="tc" id="tc_label">Tipo de Cambio: </label><br>
        <input type="number" id="tc" name="tc"><br><br>

        <input type="submit" onclick="calculate(); return false" value="Calcular">
        <input type="reset" value="Borrar">
    </form>
    </div>
    <div id="resultados">
        <p id="result"></p>
    </div>
</div>



<div class="indicaciones">
        <h5>
            Indicaciones:
        </h5>
        <p>
            En "Acción" debes elegir la acción que deseas adquirir, recuerda que una empresa puede tener más de una acción. Para cada Acción hemos colocado la empresa emisora, el ticker de esta acción y en qué moneda fue emitida. Para mayor información, puedes buscar en el siguiente <a href="https://www.bvl.com.pe/emisores/listado-emisores">link</a>.
        </p>
        <p>
            En "Precio de compra" debes colocar el precio al que planeas comprar la Acción.
        </p>
        <p>
        En "Comisión SAB(%)" y "Comisión Fija", debes colocar las tarifas de tu Sociedad Agente de Bolsa. Si ya estás afiliado a una, debes poner las comisiones pactadas con ellos. En caso de no ser asi, te invito a averiguar las comisiones de las SABs afiliadas a la Bolsa de valores de Lima <a href="https://www.bvl.com.pe/mercado/agentes/listado">aquí</a>.
        Cada una tiene una sección de Tarifarios en su sitio web y fija las comisiones de acuerdo al nivel de servicio que ofrece, el monto a invertir y el tipo de cliente.
        La comisión que se cobra es el monto mayor entre la comisión porcentual y la comisión fija. Para la calculadora, colocar la comisión porcentual como decimales; es decir, si la comisión es 1%, colocarlo como 0.01.
        </p>
        <p>
            En "Tipo de cambio" debes colocar el tipo de cambio fijado con la SAB para convertir su comisión a dólares. Esta información solo será activada cuando la acción fue emitida en dólares.
        </p>
            <h5>Ejemplo:</h5>
        <p>Una SAB cobra 1% de comisión porcentual y 50 soles de comisión fija. Si decides meter S/4,000 soles en la bolsa, entonces la SAB te cobrará S/50 al ser mayor que la comisión porcentual (4,000 x 1%=S/40).
        </p>
        <p>
            Si decides invertir S/6,000, entonces la SAB te cobrará S/60 (S/6,000 x 1%) pues resulta mayor a la comisión fija de S/50.
        </p>
        <p>
            Finalmente, el "Monto a Invertir" es el monto que decides transar con la SAB para comprar la acción. Este puede ser en soles o dólares dependiendo en qué moneda cotiza la acción. Si la acción es emitida en dólares, la "Comisión mínima" debe ser en dólares con el "Tipo de Cambio" elegido.
        </p>
</div>



<footer>
    <div>
        <p>LlamaStocks, Herramientas informativas para todos</p>
    </div>
</footer>
</html>
